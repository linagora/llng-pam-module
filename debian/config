#!/bin/sh
set -e

. /usr/share/debconf/confmodule

# Ask for PAM mode (medium priority)
db_input medium libpam-openbastion/pam-mode || true
db_go || true

db_get libpam-openbastion/pam-mode
MODE="$RET"

# If a mode is selected, ask for LLNG parameters
if [ "$MODE" != "none" ]; then
    db_input high libpam-openbastion/portal-url || true
    db_input medium libpam-openbastion/client-id || true
    db_input high libpam-openbastion/client-secret || true
    db_input low libpam-openbastion/server-group || true
    db_input medium libpam-openbastion/configure-sudo || true
    db_go || true

    # If sudo is enabled, ask for sudo server group
    db_get libpam-openbastion/configure-sudo
    if [ "$RET" = "true" ]; then
        db_input low libpam-openbastion/sudo-server-group || true
        db_go || true
    fi

    # Ask about auto-creating Unix accounts
    db_input medium libpam-openbastion/create-user || true
    db_go || true
fi

exit 0
